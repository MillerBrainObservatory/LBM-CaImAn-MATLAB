
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Pre-Processing &#8212; caiman_matlab  documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.1/css/all.min.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.1/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.1/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.1/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=362ab14a" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinxcontrib-images/LightBox2/lightbox2/dist/css/lightbox.css?v=5c84f910" />
    <link rel="stylesheet" type="text/css" href="../_static/caiman_matlab.css?v=8c8b7c0d" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae" />
  <script src="../_static/vendor/fontawesome/6.5.1/js/all.min.js?digest=8d27b9dea8ad943066ae"></script>

    <script src="../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/sphinxcontrib-images/LightBox2/lightbox2/dist/js/lightbox-plus-jquery.min.js?v=ffc8af2d"></script>
    <script src="../_static/sphinxcontrib-images/LightBox2/lightbox2-customize/jquery-noconflict.js?v=12818e64"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'user_guide/pre_processing';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Piecewise-Rigid Motion-Correction" href="registration.html" />
    <link rel="prev" title="ScanImage Metadata" href="metadata.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a id="pst-skip-link" class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <header class="bd-header navbar navbar-expand-lg bd-navbar">
<div class="bd-header__inner bd-page-width">
  <label class="sidebar-toggle primary-toggle" for="__primary">
    <span class="fa-solid fa-bars"></span>
  </label>
  
  
  <div class="col-lg-3 navbar-header-items__start">
    
      <div class="navbar-item">

  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/favicon.ico" class="logo__image only-light" alt="caiman_matlab  documentation - Home"/>
    <script>document.write(`<img src="../_static/favicon.ico" class="logo__image only-dark" alt="caiman_matlab  documentation - Home"/>`);</script>
  
  
</a></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav class="navbar-nav">
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../get_started/index.html">
                        First Steps
                      </a>
                    </li>
                

                    <li class="nav-item current active">
                      <a class="nav-link nav-internal" href="index.html">
                        User Guide
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../api/index.html">
                        API
                      </a>
                    </li>
                

                <li class="nav-item">
                  <a class="nav-link nav-external" href="https://mbo.rockefeller.edu">
                    MBO
                  </a>
                </li>
                
  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script>
        </div>
      
      
        <div class="navbar-item">

<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script>
    </div>
  

  
    <label class="sidebar-toggle secondary-toggle" for="__secondary" tabindex="0">
      <span class="fa-solid fa-outdent"></span>
    </label>
  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          <div class="navbar-item">
<nav class="navbar-nav">
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../get_started/index.html">
                        First Steps
                      </a>
                    </li>
                

                    <li class="nav-item current active">
                      <a class="nav-link nav-internal" href="index.html">
                        User Guide
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../api/index.html">
                        API
                      </a>
                    </li>
                

                <li class="nav-item">
                  <a class="nav-link nav-external" href="https://mbo.rockefeller.edu">
                    MBO
                  </a>
                </li>
                
  </ul>
</nav></div>
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">

<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
<nav class="bd-docs-nav bd-links"
     aria-label="Section Navigation">
  <p class="bd-links__title" role="heading" aria-level="1">Section Navigation</p>
  <div class="bd-toc-item navbar-nav"><p aria-level="2" class="caption" role="heading"><span class="caption-text">User Guide:</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="parameters.html">Parameters</a></li>
<li class="toctree-l1"><a class="reference internal" href="metadata.html">Metadata</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Pre_processing</a></li>
<li class="toctree-l1"><a class="reference internal" href="registration.html">Registration</a></li>
<li class="toctree-l1"><a class="reference internal" href="segmentation.html">Segmentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="offset_correction.html">Axial Alignment</a></li>
<li class="toctree-l1"><a class="reference internal" href="tips_tricks.html">Tips and Tricks</a></li>
<li class="toctree-l1"><a class="reference internal" href="troubleshooting.html">Troubleshooting</a></li>
</ul>
</div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">



<nav aria-label="Breadcrumb">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="index.html" class="nav-link">User Guide</a></li>
    
    <li class="breadcrumb-item active" aria-current="page">Pre-Processing</li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="pre-processing">
<h1>Pre-Processing<a class="headerlink" href="#pre-processing" title="Link to this heading">#</a></h1>
<p>Function for this step: <a class="reference internal" href="../api/core.html#convertScanImageTiffToVolume" title="convertScanImageTiffToVolume"><code class="xref mat mat-func docutils literal notranslate"><span class="pre">convertScanImageTiffToVolume()</span></code></a></p>
<p>Utility functions for this step:</p>
<p><span class="xref std std-ref">planeToH5</span>: Quickly view a movie of any plane.
<span class="xref std std-ref">read_H5_metadata</span>: View metadata associated with an extracted file.
<span class="xref std std-ref">get_center_indices</span>: Get the Y,X index of a box of size <cite>pixels</cite> created around the center point of an image.</p>
<p>Before beginning pre-processing, follow setup steps in <a class="reference internal" href="../get_started/getting_started.html#getting-started"><span class="std std-ref">Getting Started</span></a> to make sure the pipeline and dependencies are installed properly.
After that, review <a class="reference internal" href="parameters.html#parameters"><span class="std std-ref">Parameters</span></a> to understand the general usage of each function going foreward.</p>
<p>See <a class="reference internal" href="troubleshooting.html#troubleshooting"><span class="std std-ref">Troubleshooting</span></a> for common issues you may encounter along the way.</p>
<p>Pre-processing LBM datasets consists of 2 main processing steps:</p>
<ol class="arabic simple">
<li><p>Assemble our images</p></li>
</ol>
<ul class="simple">
<li><p>reshape vertically concatenated strips into horizontally concatenated strips.</p></li>
<li><p>reorder our images into 3D time-series.</p></li>
</ul>
<ol class="arabic simple" start="2">
<li><p>Correcting for scan-phase alignment inconsistencies</p></li>
</ol>
<section id="re-assemble-volumetric-time-series">
<span id="assembly"></span><h2>1. Re-Assemble Volumetric Time-Series<a class="headerlink" href="#re-assemble-volumetric-time-series" title="Link to this heading">#</a></h2>
<p>Before processing starts, the raw scanimage output needs to be reconstructed to form a correctly-ordered time-series.
This is accomplished through the use of <a class="reference internal" href="../api/core.html#convertScanImageTiffToVolume" title="convertScanImageTiffToVolume"><code class="xref mat mat-func docutils literal notranslate"><span class="pre">convertScanImageTiffToVolume()</span></code></a>.</p>
<p>Shown in the image below is a graphical representation of this reconstruction.</p>
<p>In its raw form (see A in the below figure), ScanImage tiff files are multipage tiffs - like a book.</p>
<p>Each page is one <em>image</em>, but it doesn’t look like an image:</p>
<a class=""
               data-lightbox="group-default"
               href="../_images/abc_strip1.png"
               title=""
               data-title=""
               
               ><img src="../_images/abc_strip1.png"
                     class=""
                     width="1440"
                     height="auto"
                     alt=""/>
                </a><div class="line-block">
<div class="line">A: In the above image, represents vertically concatenated <strong>strip</strong> of our image.</div>
<div class="line">B: Strips are cut and horizontally concatenated.</div>
<div class="line">C: After a scan-phase correction, lines between strips become unnoticable (ideally)</div>
</div>
<p><strong>If you were to open up a raw ScanImage .tiff file in ImageJ, you would see a very long, thin bar as is shown in A.</strong></p>
<ul class="simple">
<li><p>Each Z-Plane is written before moving onto the next timestep</p></li>
<li><p>z-plane 1 &#64; timepoint 1, z-plane 2 &#64; timepoint 1, z-plane 3 &#64; timepoint 1, etc.</p></li>
</ul>
<p>Thus, another task <a class="reference internal" href="../api/core.html#convertScanImageTiffToVolume" title="convertScanImageTiffToVolume"><code class="xref mat mat-func docutils literal notranslate"><span class="pre">convertScanImageTiffToVolume()</span></code></a> accomplishes are reordering this tiff stack to be:</p>
<ul class="simple">
<li><p>z-plane 1 &#64; timepont 1, z-plane 1 &#64; timepoint 2, etc ..</p></li>
</ul>
<p>The output <cite>volumetric time-series</cite> has dimensions <cite>[Y,X,Z,T]</cite>.</p>
<p>If the user chooses to split frames across multiple <cite>.tiff</cite> files, there will be multiple tiff files in ascending order
of a suffix appended to the filename: <cite>_000N</cite>, where n=number of files chosen by the user.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>All output .tiff files for a single imaging session should be placed in the same directory.
No other .tiff files should be in this directory. If this happens, an error will throw.</p>
</div>
<p id="scan-phase"><code class="xref mat mat-func docutils literal notranslate"><span class="pre">fix_scan_phase()</span></code> is a very important parameter: it attempts to maximize the phase-correlation between each line (row) of each strip, as shown below.</p>
<a class=""
               data-lightbox="group-default"
               href="../_images/corr_nocorr_phase_example1.png"
               title=""
               data-title=""
               
               ><img src="../_images/corr_nocorr_phase_example1.png"
                     class=""
                     width="1080"
                     height="auto"
                     alt=""/>
                </a><p>This example shows that shifting every <em>other</em> row of pixels +2 (to the right) in our 2D reconstructed image will maximize the correlation between adjacent rows.</p>
<p>Newer versions (2019+) of ScanImage do this correction for you, but it won’t hurt. Before any image manipulations, the routine first checks if any lateral (x) shift
will improve the correlation between adjacent rows and if not, will do nothing.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Checking for a scan-phase offset correction is computationally cheap, so it is recommended to keep this to true.</p>
</div>
<section id="extraction-input">
<h3>Extraction Input<a class="headerlink" href="#extraction-input" title="Link to this heading">#</a></h3>
<p>First, we set up our directory paths. You can chain the output of one function to the input of another. Note the path names match <a class="reference internal" href="../get_started/getting_started.html#directory-structure"><span class="std std-ref">Directory Structure</span></a>:</p>
<div class="highlight-MATLAB notranslate"><div class="highlight"><pre><span></span><span class="n">parent_path</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&#39;C:\Users\&lt;username&gt;\Documents\data\bi_hemisphere\&#39;</span><span class="p">;</span><span class="w"> </span><span class="c">%</span>
<span class="n">raw_path</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="n">parent_path</span><span class="w"> </span><span class="s">&#39;raw\&#39;</span><span class="p">];</span><span class="w"> </span><span class="c">% where our raw .tiffs go</span>
<span class="n">extract_path</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="n">parent_path</span><span class="w"> </span><span class="s">&#39;extracted\&#39;</span><span class="p">];</span>
<span class="nb">mkdir</span><span class="p">(</span><span class="n">extract_path</span><span class="p">);</span><span class="w"> </span><span class="nb">mkdir</span><span class="p">(</span><span class="n">raw_path</span><span class="p">);</span>
</pre></div>
</div>
<p>This is all you need to start processing your data. Actually, it’s quite more than you need.</p>
<p><cite>raw_path</cite> is where your raw <cite>.tiff</cite> files will be stored and is the first parameter of <a class="reference internal" href="../api/core.html#convertScanImageTiffToVolume" title="convertScanImageTiffToVolume"><code class="xref mat mat-func docutils literal notranslate"><span class="pre">convertScanImageTiffToVolume()</span></code></a>.
<cite>extract_path</cite> is where our data will be saved, and is the second parameter.
- Your raw and extract path can be in any folder you wish without worry of file-name conflicts.
- All future pipeline steps will automatically exclude these files as they will not have the characters <cite>_plane_</cite> in the filename.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Don’t put the characters <cite>_plane_</cite> together in your raw/extracted filenames!</p>
</div>
<p><cite>debug_flag</cite> is the next parameter, setting this to 1, ‘1’, or true will display the detected files that would be processed, and stop. This is helpful for controlling which files are processed.</p>
<p><cite>overwrite</cite>, similar to diagnostic flag, can be set to 1, ‘1’, or true to enable overwriting any previously extracted data. Otherwise, a warning will show and no data will be saved.</p>
</section>
<section id="extraction-output">
<h3>Extraction Output<a class="headerlink" href="#extraction-output" title="Link to this heading">#</a></h3>
<p>Our data are now saved as a single h5 file separated by file and by plane. This storage format
makes it easy to motion correct each 3D planar time-series individually. We will be processing small patches of the total image,
roughly 20um in parallel, so attempting to process multiple time-series will drastically slow down NormCorre.
After successfully running <a class="reference internal" href="../api/core.html#convertScanImageTiffToVolume" title="convertScanImageTiffToVolume"><code class="xref mat mat-func docutils literal notranslate"><span class="pre">convertScanImageTiffToVolume()</span></code></a>, there will be a single <cite>.h5</cite> file containing extracted data.</p>
<p>You can use <code class="code docutils literal notranslate"><span class="pre">h5info(h5path)</span></code> in the MATLAB command window to reveal some helpful information about our data.</p>
<p>The following is an example structure of the HDF5 file at the outermost level:</p>
<div class="highlight-MATLAB notranslate"><div class="highlight"><pre><span></span><span class="nb">h5info</span><span class="p">(</span><span class="n">extract_path</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;/extraction&#39;</span><span class="p">)</span>

<span class="n">Filename</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;C:\Users\&lt;username&gt;\MH184_both_6mm_FOV_150_600um_depth_410mW_9min_no_stimuli_00001_00001.h5&#39;</span>
<span class="n">Name</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;/extraction&#39;</span>
<span class="n">Groups</span><span class="p">:</span>
<span class="w">    </span><span class="o">/</span><span class="n">plane_1</span>
<span class="w">    </span><span class="o">/</span><span class="n">plane_2</span>
<span class="w">    </span><span class="o">/</span><span class="n">plane_3</span>
<span class="w">    </span><span class="o">/</span><span class="n">plane_N</span>
<span class="n">Datasets</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span>
<span class="n">Datatypes</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span>
<span class="n">Links</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span>
<span class="n">Attributes</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span>
</pre></div>
</div>
<p>We see here that our “parent” group has 3 subgroups corresponding to the number of raw .tiff files. Lets explore one of these “plane” subgroups:</p>
<p>We see that there are 30 datasets corresponding to each of our Z-planes, but no groups or attributes. That information is stored within each plane:</p>
<div class="highlight-MATLAB notranslate"><div class="highlight"><pre><span></span><span class="nb">h5info</span><span class="p">(</span><span class="n">extract_path</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;/plane_1&#39;</span><span class="p">)</span>

<span class="w">  </span><span class="nb">struct</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">fields</span><span class="p">:</span>

<span class="w">  </span><span class="n">Filename</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;C:\Users\&lt;username&gt;\extracted\MH184_both_6mm_FOV_150_600um_depth_410mW_9min_no_stimuli_00001_00001.h5&#39;</span>
<span class="w">      </span><span class="n">Name</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;plane_1&#39;</span>
<span class="w">  </span><span class="n">Datatype</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mi">1</span>×<span class="mi">1</span><span class="w"> </span><span class="nb">struct</span><span class="p">]</span>
<span class="w"> </span><span class="n">Dataspace</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mi">1</span>×<span class="mi">1</span><span class="w"> </span><span class="nb">struct</span><span class="p">]</span>
<span class="w"> </span><span class="n">ChunkSize</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mi">1165</span><span class="w"> </span><span class="mi">1202</span><span class="w"> </span><span class="mi">1</span><span class="p">]</span>
<span class="w"> </span><span class="n">FillValue</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span>
<span class="w">   </span><span class="n">Filters</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mi">1</span>×<span class="mi">1</span><span class="w"> </span><span class="nb">struct</span><span class="p">]</span>
<span class="n">Attributes</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mi">30</span>×<span class="mi">1</span><span class="w"> </span><span class="nb">struct</span><span class="p">]</span>
</pre></div>
</div>
<ul class="simple">
<li><p><strong>Groups</strong>: h5 files can be thought of like directories where a 3D time-series is self contained within its own folder (or group).</p></li>
<li><p><strong>Attributes</strong>: Attributes are special “tags” attached to a group. This is where we store metadata associated with each group and dataset. The result of calling <cite>get_metadata(raw_path)</cite> (see <a class="reference internal" href="metadata.html#scanimage-metadata"><span class="std std-ref">ScanImage Metadata</span></a> for more information about the magic behind the scenes here).</p></li>
</ul>
</section>
</section>
<section id="evaluate-output">
<h2>Evaluate output<a class="headerlink" href="#evaluate-output" title="Link to this heading">#</a></h2>
<p>In your <cite>save_path</cite>, you will see a newly created <cite>figures</cite> folder.</p>
<p>In this folder is a close-up of the brightest image in every plane for a random frame. Each
image shoes the neuron before and after scan-correction. This lets you compare planes, validate the correct
scan-phase offset value (usually 1, 2 or 3 pixels).</p>
<p>Lets see the first z-plane:</p>
<a class=""
               data-lightbox="group-default"
               href="../_images/plane_11.png"
               title=""
               data-title=""
               
               ><img src="../_images/plane_11.png"
                     class=""
                     width="1440"
                     height="auto"
                     alt=""/>
                </a><p>Lets see the tenth z-plane:</p>
<a class=""
               data-lightbox="group-default"
               href="../_images/plane_101.png"
               title=""
               data-title=""
               
               ><img src="../_images/plane_101.png"
                     class=""
                     width="1440"
                     height="auto"
                     alt=""/>
                </a><p>So far so good, but as we approach the end-plane (by order, not by depth):</p>
<a class=""
               data-lightbox="group-default"
               href="../_images/plane_301.png"
               title=""
               data-title=""
               
               ><img src="../_images/plane_301.png"
                     class=""
                     width="1440"
                     height="auto"
                     alt=""/>
                </a><p>You should do some checks to make sure data was written properly before continuing. There are a few convenience functions
to view a movie provided in the pipeline. Below is an example:</p>
<div class="highlight-MATLAB notranslate"><div class="highlight"><pre><span></span><span class="c">%% View info about your newly extracted dataset</span>
<span class="n">h5files</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">dir</span><span class="p">([</span><span class="n">extraction_path</span><span class="w"> </span><span class="s">&#39;*.h5&#39;</span><span class="p">]);</span>
<span class="n">h5name</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">fullfile</span><span class="p">(</span><span class="n">extraction_path</span><span class="p">,</span><span class="w"> </span><span class="n">h5files</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">name</span><span class="p">);</span>
<span class="n">dataset_path</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">sprintf</span><span class="p">(</span><span class="s">&#39;/extraction/plane_%d&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">plane</span><span class="p">);</span>
<span class="n">has_mc</span><span class="p">(</span><span class="n">h5name</span><span class="p">)</span>
<span class="n">data</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">h5read</span><span class="p">(</span><span class="w"> </span><span class="k">...</span>
<span class="w">    </span><span class="n">h5name</span><span class="p">,</span><span class="w"> </span><span class="k">...</span><span class="c"> % filename</span>
<span class="w">    </span><span class="n">dataset_path</span><span class="p">,</span><span class="w"> </span><span class="k">...</span><span class="c"> % dataset location</span>
<span class="w">    </span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">frame_start</span><span class="p">],</span><span class="w"> </span><span class="k">...</span><span class="c"> % start index for each dimension [X,Y,T]</span>
<span class="w">    </span><span class="p">[</span><span class="nb">Inf</span><span class="p">,</span><span class="w"> </span><span class="nb">Inf</span><span class="p">,</span><span class="w">  </span><span class="n">frame_end</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">frame_start</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="k">...</span><span class="c"> % count for each dimension [X,Y,T]</span>
<span class="w">    </span><span class="p">);</span>

<span class="w"> </span><span class="nb">figure</span><span class="p">;</span>
<span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">1</span><span class="p">:</span><span class="nb">size</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span>
<span class="w">     </span><span class="nb">imshow</span><span class="p">(</span><span class="n">data</span><span class="p">(</span><span class="mi">236</span><span class="p">:</span><span class="mi">408</span><span class="p">,</span><span class="w"> </span><span class="mi">210</span><span class="p">:</span><span class="mi">377</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">),</span><span class="w"> </span><span class="p">[]);</span>
<span class="w">     </span><span class="nb">title</span><span class="p">(</span><span class="nb">sprintf</span><span class="p">(</span><span class="s">&#39;Frame %d&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">start_frame</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">));</span>
<span class="w"> </span><span class="k">end</span>
</pre></div>
</div>
</section>
</section>


                </article>
              
              
              
              
              
                <footer class="prev-next-footer">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="metadata.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">ScanImage Metadata</p>
      </div>
    </a>
    <a class="right-next"
       href="registration.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Piecewise-Rigid Motion-Correction</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
<div
    id="pst-page-navigation-heading-2"
    class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc" aria-labelledby="pst-page-navigation-heading-2">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#re-assemble-volumetric-time-series">1. Re-Assemble Volumetric Time-Series</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#extraction-input">Extraction Input</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#extraction-output">Extraction Output</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#evaluate-output">Evaluate output</a></li>
</ul>
  </nav></div>

  <div class="sidebar-secondary-item">

  <div class="tocsection sourcelink">
    <a href="../_sources/user_guide/pre_processing.rst.txt">
      <i class="fa-solid fa-file-lines"></i> Show Source
    </a>
  </div>
</div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">

  <p class="copyright">
    
      © Copyright 2024, Elizabeth R. Miller Brain Observatory (MBO) | The Rockefeller University. All Rights Reserved..
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">

  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.3.7.
    <br/>
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">
<p class="theme-version">
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.15.2.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>